# ObscuraRT: Real-Time Video Anonymization at the Edge

## Overview

**ObscuraRT** is a GPU-accelerated, privacy-preserving video processing system that anonymizes video frames in real-time using **Vulkan compute shaders**. Designed for edge deployment, it processes video locally without sending raw frames to the cloud.

### Key Architecture

```
Camera/Video Source
    ↓
FrameGrabber (CPU)
    ↓ [zero-copy if possible]
GPU Memory
    ├─ Input Buffer (YUV420/RGB)
    ├─ Compute Pipeline
    │  └─ Pixelation Shader
    └─ Output Buffer
    ↓
Display (GLFW + Vulkan)
```

---

## Why Vulkan Compute?

| Alternative | Issue |
|------------|-------|
| OpenCV CPU | 30 FPS @ 1080p = bottleneck |
| CUDA | Vendor lock-in (NVIDIA only) |
| OpenCL | Ecosystem dead |
| **Vulkan** | ✅ Cross-GPU, low-level, <10ms latency |

---

## Project Structure

```
ObscuraRT/
├── CMakeLists.txt
├── include/
│   ├── vulkan_context.h       # Vulkan instance/device management
│   ├── frame_grabber.h         # Input: camera/file
│   ├── compute_pipeline.h      # GPU compute shaders
│   └── display_pipeline.h      # Output: GLFW window
├── src/
│   ├── main.cpp
│   ├── vulkan_context.cpp
│   ├── frame_grabber.cpp
│   ├── compute_pipeline.cpp
│   └── display_pipeline.cpp
├── shaders/
│   ├── pixelation.comp         # Main compute shader
│   ├── display.vert
│   └── display.frag
├── build/                       # (generated by CMake)
└── README.md
```

---

## MVP Features (Current Phase)

- ✅ Vulkan context + device selection
- ✅ Test pattern frame generation (FrameGrabber)
- ✅ Compute pipeline skeleton
- ✅ Pixelation compute shader (GLSL)
- ⏳ Display pipeline (GLFW window)
- ⏳ Frame upload/download GPU memory
- ⏳ Full shader execution & synchronization

---

## Build & Run

### Prerequisites

```bash
# Ubuntu/Debian
sudo apt-get install \
    vulkan-tools vulkan-headers libvulkan-dev \
    libglfw3-dev libglfw3 \
    libopencv-dev \
    glslc

# macOS (with homebrew)
brew install vulkan-headers glfw opencv
```

### Build

```bash
cd ObscuraRT
mkdir -p build && cd build
cmake ..
make -j$(nproc)
```

### Run

```bash
./obscura_rt
```

---

## Next Steps (V1 Roadmap)

### Phase 1: Core MVP
- [ ] Complete display pipeline (swapchain, renderpass)
- [ ] GPU buffer allocation & memory barriers
- [ ] Compute shader execution + synchronization
- [ ] Real-time pixelation on test pattern
- [ ] FPS monitoring

### Phase 2: Real Input
- [ ] V4L2 webcam integration
- [ ] YUV420 → RGBA conversion (GPU or CPU)
- [ ] Frame metadata (width, height, timestamp)

### Phase 3: Face Detection
- [ ] Haar cascade or lightweight CNN
- [ ] Selective pixelation (face region only)
- [ ] Multi-face support

### Phase 4: Advanced
- [ ] Video file output (H.264/H.265)
- [ ] Temporal smoothing (motion-aware blur)
- [ ] CLI + config file
- [ ] Performance profiling (GPU timestamps)

---

## Technical Notes

### Memory Model

- **Zero-copy goal**: V4L2 mmap → GPU via VkBuffer mapped memory
- **Fallback**: CPU staging buffer → GPU transfer
- **Double-buffering**: Ping-pong textures for pipeline parallelism

### Synchronization

```
Frame N-1: GPU compute
Frame N:   CPU grab + memory barrier
Frame N+1: GPU present
```

Use:
- `VkMemoryBarrier` between compute passes
- `VkFence` for CPU-GPU sync
- `VkSemaphore` for queue submissions

### Shader Compilation

GLSL → SPIR-V (via `glslc`):

```bash
glslc -o shaders/pixelation.comp.spv shaders/pixelation.comp
```

CMake does this automatically.

---

## Debugging

### Validation Layers

Enable in release builds:

```cpp
// In vulkan_context.cpp
const char* validationLayers[] = {"VK_LAYER_KHRONOS_validation"};
```

### GPU Debug Tools

```bash
# Use RenderDoc or NVIDIA Nsight
renderdoc ./build/obscura_rt
```

### Logs

All components emit `[ComponentName]` prefixed logs to stdout.

---

## Performance Targets

- **Latency**: <15ms per frame @ 1080p
- **Throughput**: 60+ FPS @ 1080p
- **GPU Memory**: <500 MB
- **CPU Usage**: <20% (frame grab + sync)

---

## Contributing

1. Follow C++20 standard
2. Use `vk::` prefix for Vulkan types (optional; currently using raw Vulkan)
3. Validate shaders with `glslangValidator`
4. Test on iGPU + discrete GPU

---

## License

MIT (placeholder)

---

## References

- [Vulkan Specification](https://www.khronos.org/vulkan/)
- [GLFW](https://www.glfw.org/)
- [OpenCV](https://opencv.org/)
