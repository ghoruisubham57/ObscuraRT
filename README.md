![Platform](https://img.shields.io/badge/platform-linux%20%7C%20windows-lightgrey)
![Language](https://img.shields.io/badge/language-C%2B%2B20-blue)
![Graphics](https://img.shields.io/badge/graphics-Vulkan%201.3-red)
![Build](https://img.shields.io/badge/build-CMake-success)
![Status](https://img.shields.io/badge/status-active%20development-orange)

[![License: AGPL v3](https://img.shields.io/badge/License-AGPL%20v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0)
![Commercial](https://img.shields.io/badge/commercial-license%20available-important)

![GitHub Repo stars](https://img.shields.io/github/stars/WlayerX/ObscuraRT?style=flat)
![GitHub issues](https://img.shields.io/github/issues/WlayerX/ObscuraRT)

# ObscuraRT: Real-Time Video Anonymization at the Edge

## Star History

[![Star History Chart](https://api.star-history.com/svg?repos=WlayerX/ObscuraRT&type=date&legend=bottom-right)](https://www.star-history.com/#WlayerX/ObscuraRT&type=date&legend=bottom-right)

## Overview

**ObscuraRT** is a GPU-accelerated, privacy-preserving video processing system that anonymizes video frames in real-time using **Vulkan compute shaders**. Designed for edge deployment, it processes video locally without sending raw frames to the cloud.

### Key Architecture

```
Camera/Video Source
    ↓
FrameGrabber (CPU)
    ↓ [zero-copy if possible]
GPU Memory
    ├─ Input Buffer (YUV420/RGB)
    ├─ Compute Pipeline
    │  └─ Pixelation Shader
    └─ Output Buffer
    ↓
Display (GLFW + Vulkan)
```

---

## Why Vulkan Compute?

| Alternative | Issue |
|------------|-------|
| OpenCV CPU | 30 FPS @ 1080p = bottleneck |
| CUDA | Vendor lock-in (NVIDIA only) |
| OpenCL | Ecosystem dead |
| **Vulkan** | ✅ Cross-GPU, low-level, <10ms latency |

---

## Project Structure

```
ObscuraRT/
├── CMakeLists.txt
├── include/
│   ├── vulkan_context.h       # Vulkan instance/device management
│   ├── frame_grabber.h         # Input: camera/file
│   ├── compute_pipeline.h      # GPU compute shaders
│   └── display_pipeline.h      # Output: GLFW window
├── src/
│   ├── main.cpp
│   ├── vulkan_context.cpp
│   ├── frame_grabber.cpp
│   ├── compute_pipeline.cpp
│   └── display_pipeline.cpp
├── shaders/
│   ├── pixelation.comp         # Main compute shader
│   ├── display.vert
│   └── display.frag
├── build/                       # (generated by CMake)
└── README.md
```

---

## MVP Features (Current Phase)

- ✅ Vulkan context + device selection
- ✅ Test pattern frame generation (FrameGrabber)
- ✅ Compute pipeline skeleton
- ✅ Pixelation compute shader (GLSL)
- ⏳ Display pipeline (GLFW window)
- ⏳ Frame upload/download GPU memory
- ⏳ Full shader execution & synchronization

---

## Build & Run

### Prerequisites

```bash
# Ubuntu/Debian
sudo apt-get install \
    vulkan-tools vulkan-headers libvulkan-dev \
    libglfw3-dev libglfw3 \
    libopencv-dev \
    glslc

# macOS (with homebrew)
brew install vulkan-headers glfw opencv
```

### Build

```bash
cd ObscuraRT
mkdir -p build && cd build
cmake ..
make -j$(nproc)
```

### Run

```bash
./obscura_rt
```

---

## Next Steps (V1 Roadmap)

### Phase 1: Core MVP
- [X] Complete display pipeline (swapchain, renderpass)
- [X] GPU buffer allocation & memory barriers
- [X] Compute shader execution + synchronization
- [X] Real-time pixelation on test pattern
- [X] FPS monitoring

**Status:**  
Phase 1 is fully completed. The application has a functional Vulkan render + compute pipeline with real-time processing and performance metrics.

### Phase 2: Real Input
- [ ] V4L2 webcam integration
- [ ] YUV420 → RGBA conversion (GPU or CPU)
- [ ] Frame metadata (width, height, timestamp)

### Phase 3: Face Detection
- [ ] Haar cascade or lightweight CNN
- [ ] Selective pixelation (face region only)
- [ ] Multi-face support

### Phase 4: Advanced
- [ ] Video file output (H.264/H.265)
- [ ] Temporal smoothing (motion-aware blur)
- [ ] CLI + config file
- [ ] Performance profiling (GPU timestamps)

---

## Technical Notes

### Memory Model

- **Zero-copy goal**: V4L2 mmap → GPU via VkBuffer mapped memory
- **Fallback**: CPU staging buffer → GPU transfer
- **Double-buffering**: Ping-pong textures for pipeline parallelism

### Synchronization

```
Frame N-1: GPU compute
Frame N:   CPU grab + memory barrier
Frame N+1: GPU present
```

Use:
- `VkMemoryBarrier` between compute passes
- `VkFence` for CPU-GPU sync
- `VkSemaphore` for queue submissions

### Shader Compilation

GLSL → SPIR-V (via `glslc`):

```bash
glslc -o shaders/pixelation.comp.spv shaders/pixelation.comp
```

CMake does this automatically.

---

## Debugging

### Validation Layers

Enable in release builds:

```cpp
// In vulkan_context.cpp
const char* validationLayers[] = {"VK_LAYER_KHRONOS_validation"};
```

### GPU Debug Tools

```bash
# Use RenderDoc or NVIDIA Nsight
renderdoc ./build/obscura_rt
```

### Logs

All components emit `[ComponentName]` prefixed logs to stdout.

---

## Performance Targets

- **Latency**: <15ms per frame @ 1080p
- **Throughput**: 60+ FPS @ 1080p
- **GPU Memory**: <500 MB
- **CPU Usage**: <20% (frame grab + sync)

---

## Contributing

1. Follow C++20 standard
2. Use `vk::` prefix for Vulkan types (optional; currently using raw Vulkan)
3. Validate shaders with `glslangValidator`
4. Test on iGPU + discrete GPU

---

## License

This project is licensed under the **GNU Affero General Public License v3.0 (AGPL-3.0)**.

You are free to use, modify, and distribute this software, including for **commercial purposes**,  
**provided that** any modified version or service using this software is also licensed under AGPL-3.0
and the **complete corresponding source code is made available**.

---

## Network Use Disclosure (AGPL Notice)

If you run this software as a **network service** (e.g. SaaS, web app, API, hosted service),
you are required to provide the **complete source code** of your modified version
to all users interacting with it over the network, as required by the AGPL-3.0.

---

## References

- [Vulkan Specification](https://www.khronos.org/vulkan/)
- [GLFW](https://www.glfw.org/)
- [OpenCV](https://opencv.org/)

## Contributing

By contributing to this project, you agree that your contributions
will be licensed under the **AGPL-3.0**, unless explicitly stated otherwise

## Disclaimer

This software is provided **"as is"**, without warranty of any kind.
See the AGPL-3.0 license for details.

## Commercial Licensing

If you require a license that does not impose AGPL-3.0 obligations
(e.g. closed-source or proprietary use), please contact the author.

## Copyright

Copyright © 2025 Semih Taha Aksoy (aka WlayerX)

Original authorship and copyright notices **must be preserved**
in all copies and derived works, as required by the license.
